


⸻

📌 Claude 后端提示词（续写部分）

⸻

⚙️ 模块 1：第三方词典 API 封装模块

✅ 功能说明：

将外部词典服务（如 DictionaryAPI.dev、Youdao、Cambridge 等）统一封装为适配器，便于扩展。

✅ Claude执行要求：
	1.	创建模块：services/word_lookup/lookup_client.py
	2.	定义接口：

class WordLookupClient:
    def lookup(self, word: str) -> WordLookupResult: ...


	3.	默认使用 DictionaryAPI.dev（支持免费英文词典）
	4.	若失败可切换备用服务（如有道）
	5.	创建统一数据模型 WordLookupResult 包含：

class WordLookupResult(BaseModel):
    word: str
    phonetics_uk: str
    phonetics_us: str
    audio_uk_url: str
    audio_us_url: str
    meanings: List[str]



⸻

💽 模块 2：本地缓存机制（可选，优化响应速度）

✅ 功能说明：

为了避免每次都请求外部词典，支持本地缓存查询结果。

✅ Claude执行要求：
	1.	创建缓存数据库表：cached_word_results
	•	word, phonetics, audio_url, meanings, updated_at
	2.	每次查询前优先查本地
	3.	如果外部查询成功 → 写入/更新本地缓存
	4.	增加过期检测逻辑（如7天自动失效）

⸻

📊 模块 3：生词本收藏接口逻辑（已在前文描述）

✅ Claude执行提醒：
	•	用户收藏词汇前必须查询本地缓存或外部API
	•	user_id 可通过 FastAPI 的依赖注入方式从 JWT Token 提取（如有登录）
	•	收藏时需校验是否重复

⸻

🔧 模块 4：API 配置管理与多源支持

✅ 功能说明：

为了未来可灵活接入多个外部服务，所有第三方API的Key和URL必须集中配置在 YAML 文件中。

✅ Claude执行要求：
	1.	创建文件：config/external_apis.yaml，例如：

dictionaryapi:
  base_url: https://api.dictionaryapi.dev/api/v2/entries/en/
  enabled: true

youdao:
  base_url: https://openapi.youdao.com/api
  app_id: YOUR_ID
  app_key: YOUR_KEY
  enabled: false

	2.	创建加载模块：utils/api_config_loader.py

def load_api_config(provider: str) -> Dict[str, Any]: ...


	3.	禁止在业务代码中硬编码任何 Key/URL，必须全部读取配置。

⸻

📁 模块结构建议

backend/
├── routers/
│   └── word_lookup_router.py         # 提供 /api/words/lookup 和 /favorite 接口
│
├── services/
│   └── word_lookup/
│       ├── lookup_client.py          # 外部词典适配器
│       └── cache_manager.py          # 本地缓存模块（可选）
│
├── models/
│   └── word_models.py                # WordLookupResult, FavoriteWord 等模型
│
├── database/
│   └── vocab_favorites.py            # 生词本数据操作逻辑
│
├── config/
│   └── external_apis.yaml            # 第三方词典服务配置


⸻

✅ Claude 成功交付标准

模块	判断标准
📘 查询接口	返回标准结构的释义、音标、发音地址
📘 缓存模块	第一次查询后写入，后续可命中
📘 收藏接口	支持用户唯一收藏逻辑、返回成功/失败状态
📘 配置管理	所有 API Key 都在 YAML 中集中配置
📘 错误处理	外部 API 异常能正常提示用户，避免报错中断


⸻
