# çœŸæ­£çš„è§£å†³æ–¹æ¡ˆ

## é—®é¢˜æœ¬è´¨

**å½“å‰é€»è¾‘**ï¼š
```python
TEXT1åˆ°è¾¾ â†’ åˆ›å»ºå¥å­1 (is_complete=False)
AUDIOç´¯ç§¯...
TEXT2åˆ°è¾¾ â†’ æ ‡è®°å¥å­1å®Œæˆ (is_complete=True) â† å»¶è¿Ÿåœ¨è¿™é‡Œï¼
         â†’ åˆ›å»ºå¥å­2 (is_complete=False)
```

**é—®é¢˜**ï¼šå¥å­1å¿…é¡»ç­‰TEXT2åˆ°è¾¾æ‰èƒ½æ’­æ”¾ï¼

---

## è§£å†³æ–¹æ¡ˆï¼šæ”¶åˆ°è¶³å¤ŸéŸ³é¢‘å°±æ ‡è®°å®Œæˆ

**ç­–ç•¥**ï¼š
- TEXTåˆ°è¾¾æ—¶åˆ›å»ºå¥å­ï¼ˆä¸å˜ï¼‰
- AUDIOç´¯ç§¯æ—¶æ£€æŸ¥ï¼šå¦‚æœç´¯ç§¯äº†è¶³å¤Ÿé•¿çš„éŸ³é¢‘ï¼ˆæ¯”å¦‚500msï¼‰ï¼Œå°±æ ‡è®°å½“å‰å¥å­å®Œæˆ
- ä¸ç­‰ä¸‹ä¸€ä¸ªTEXT

**å®ç°**ï¼š

```python
def append_audio_chunk(self, audio_data: AudioData):
    # ... ç°æœ‰è§£ç é€»è¾‘ä¸å˜ ...

    # ğŸš€ æ–°å¢ï¼šæ£€æŸ¥å½“å‰å¥å­æ˜¯å¦å·²æœ‰è¶³å¤ŸéŸ³é¢‘å¯æ’­æ”¾
    if self._sentences and not self._sentences[-1]["is_complete"]:
        current_sentence = self._sentences[-1]
        audio_duration = (len(self._pcm_chunks) - current_sentence["start_chunk"]) * 0.04  # æ¯å¸§40ms

        # å¦‚æœç´¯ç§¯äº†500msä»¥ä¸ŠéŸ³é¢‘ï¼Œæ ‡è®°å¯æ’­æ”¾
        if audio_duration >= 0.5:  # 500ms
            current_sentence["end_chunk"] = len(self._pcm_chunks)
            current_sentence["is_complete"] = True
            logger.info(f"ğŸš€ éŸ³é¢‘ç´¯ç§¯è¶³å¤Ÿï¼Œæ ‡è®°å¥å­å¯æ’­æ”¾: {audio_duration:.1f}s")
```

**ä¼˜åŠ¿**ï¼š
- âœ… ä¸ç ´åå¥å­åˆ›å»ºé€»è¾‘ï¼ˆTEXTä»ç„¶åˆ›å»ºå¥å­ï¼‰
- âœ… éŸ³é¢‘ç´¯ç§¯åˆ°500mså°±å¯ä»¥æ’­æ”¾
- âœ… ä¸ä¾èµ–ä¸‹ä¸€ä¸ªTEXT
- âœ… å¥å­è¾¹ç•Œä»ç„¶ç”±TEXTå®šä¹‰ï¼ˆå†å²è®°å½•æ­£ç¡®ï¼‰

**é£é™©**ï¼š
- âš ï¸ å¦‚æœTEXTæ™šäº500msåˆ°è¾¾ï¼Œå¥å­åˆ‡åˆ†å¯èƒ½ä¸å‡†ï¼ˆä½†æ¦‚ç‡ä½ï¼‰
