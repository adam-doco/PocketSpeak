# PocketSpeak V1.2 ç”¨æˆ·å¼•å¯¼æµç¨‹å‰ç«¯å¼€å‘æ–‡æ¡£

**æ‰§è¡Œæ—¶é—´**: 2025-01-17
**ç‰ˆæœ¬**: V1.2
**ä»»åŠ¡**: ç”¨æˆ·å¼•å¯¼æµç¨‹å‰ç«¯å¼€å‘
**çŠ¶æ€**: âœ… å®Œæˆ
**æœ€åæ›´æ–°**: 2025-01-17 (å¢åŠ è‹±è¯­æ°´å¹³è¯¦ç»†è¯´æ˜)

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

æ ¹æ® [pocketspeak_PRD_v1.2.md](../backend_claude_memory/specs/pocketspeak_PRD_v1.2.md) çš„éœ€æ±‚ï¼Œå®ç°ç”¨æˆ·é¦–æ¬¡å¯åŠ¨æ—¶çš„ä¿¡æ¯æ”¶é›†æµç¨‹ï¼ŒåŒ…æ‹¬å­¦ä¹ ç›®æ ‡ã€è‹±è¯­æ°´å¹³ã€å¹´é¾„æ®µç­‰åŸºç¡€ä¿¡æ¯çš„é‡‡é›†ã€‚

---

## ğŸ¯ å®ç°ç›®æ ‡

1. **ç”¨æˆ·å¼•å¯¼æµç¨‹**: é¦–æ¬¡å¯åŠ¨æ—¶å±•ç¤ºæ¬¢è¿é¡µ â†’ ä¿¡æ¯è¡¨å•é¡µ â†’ å®Œæˆç¡®è®¤é¡µ
2. **æ•°æ®æ”¶é›†**: æ”¶é›†ç”¨æˆ·å­¦ä¹ ç›®æ ‡ã€è‹±è¯­æ°´å¹³ã€å¹´é¾„æ®µ
3. **æœ¬åœ°å­˜å‚¨**: ä½¿ç”¨ SharedPreferences å­˜å‚¨ç”¨æˆ·æ¡£æ¡ˆ
4. **æµç¨‹æ§åˆ¶**: æ ¹æ®å¼•å¯¼å®ŒæˆçŠ¶æ€å†³å®šåº”ç”¨å…¥å£é¡µé¢

---

## ğŸ“¦ æ–°å¢æ–‡ä»¶æ¸…å•

### 1. æ•°æ®æ¨¡å‹
ğŸ“„ `lib/models/user_profile.dart`
- **UserProfile** ç±»ï¼šç”¨æˆ·æ¡£æ¡ˆæ•°æ®æ¨¡å‹
- **LearningGoal** æšä¸¾ï¼šå­¦ä¹ ç›®æ ‡é€‰é¡¹
- **EnglishLevel** æšä¸¾ï¼šè‹±è¯­æ°´å¹³é€‰é¡¹
- **AgeGroup** æšä¸¾ï¼šå¹´é¾„æ®µé€‰é¡¹

### 2. é¡µé¢ç»„ä»¶
ğŸ“„ `lib/pages/onboarding/welcome_page.dart`
- æ¬¢è¿é¡µï¼Œå±•ç¤º App logo å’Œæ¬¢è¿è¯
- ç‚¹å‡»"å¼€å§‹ä½¿ç”¨"è¿›å…¥ä¿¡æ¯è¡¨å•é¡µ

ğŸ“„ `lib/pages/onboarding/user_info_form_page.dart`
- ç”¨æˆ·ä¿¡æ¯è¡¨å•é¡µï¼ŒåŒ…å«ä¸‰ä¸ªé—®é¢˜ï¼š
  - Q1: ç»ƒä¹ è‹±è¯­å£è¯­çš„ä¸»è¦ç›®çš„
  - Q2: ç›®å‰çš„è‹±è¯­æ°´å¹³
  - Q3: ç›®å‰çš„å¹´é¾„æ®µ
- æäº¤åä¿å­˜æ•°æ®å¹¶è¿›å…¥å®Œæˆé¡µ

ğŸ“„ `lib/pages/onboarding/onboarding_complete_page.dart`
- å¼•å¯¼å®Œæˆé¡µï¼Œæç¤º"ä½ çš„è‹±è¯­AIåŠ©æ‰‹å·²å‡†å¤‡å¥½"
- ç‚¹å‡»"å¼€å§‹å¯¹è¯"è¿›å…¥ä¸»èŠå¤©ç•Œé¢

### 3. æœåŠ¡å±‚
ğŸ“„ `lib/services/user_storage_service.dart`
- **UserStorageService** ç±»ï¼šç”¨æˆ·æ•°æ®æœ¬åœ°å­˜å‚¨æœåŠ¡
- æä¾›ä¿å­˜ã€è¯»å–ã€æ£€æŸ¥ã€æ¸…é™¤ç”¨æˆ·æ•°æ®ç­‰åŠŸèƒ½

### 4. é›†æˆä¿®æ”¹
ğŸ“„ `lib/main.dart` (ä¿®æ”¹)
- å¢åŠ ç”¨æˆ·å¼•å¯¼æµç¨‹çŠ¶æ€æ£€æŸ¥
- ä¿®æ”¹åº”ç”¨å¯åŠ¨é€»è¾‘ï¼šå¼•å¯¼æµç¨‹ â†’ è®¾å¤‡æ¿€æ´» â†’ ä¸»ç•Œé¢

ğŸ“„ `pubspec.yaml` (ä¿®æ”¹)
- æ–°å¢ä¾èµ–ï¼š
  - `shared_preferences: ^2.2.2` - æœ¬åœ°æ•°æ®å­˜å‚¨
  - `uuid: ^4.2.2` - UUID ç”Ÿæˆ
  - `device_info_plus: ^10.0.1` - è®¾å¤‡ä¿¡æ¯è·å–

---

## ğŸ”§ æ ¸å¿ƒå®ç°é€»è¾‘

### 1. ç”¨æˆ·æ•°æ®æ¨¡å‹

```dart
class UserProfile {
  final String userId;        // UUID
  final String deviceId;       // è®¾å¤‡ID
  final String learningGoal;   // å­¦ä¹ ç›®æ ‡ (business/exam/daily/travel/other)
  final String englishLevel;   // è‹±è¯­æ°´å¹³ (A1/A2/B1/B2/C1/C2/uncertain)
  final String ageGroup;       // å¹´é¾„æ®µ (12-20/21-30/31-40/41-50/51+)
  final DateTime createdAt;    // åˆ›å»ºæ—¶é—´
  final DateTime lastActive;   // æœ€åæ´»è·ƒæ—¶é—´
}
```

### 2. é¡µé¢æµç¨‹

```
åº”ç”¨å¯åŠ¨
  â†“
æ£€æŸ¥å¼•å¯¼å®ŒæˆçŠ¶æ€ (UserStorageService.isOnboardingComplete())
  â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æœªå®Œæˆå¼•å¯¼æµç¨‹   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
  â†“
WelcomePage (æ¬¢è¿é¡µ)
  â†“
UserInfoFormPage (ä¿¡æ¯è¡¨å•é¡µ)
  â”œâ”€ Q1: å­¦ä¹ ç›®çš„
  â”œâ”€ Q2: è‹±è¯­æ°´å¹³
  â””â”€ Q3: å¹´é¾„æ®µ
  â†“
ä¿å­˜ç”¨æˆ·æ¡£æ¡ˆ (UserStorageService.saveUserProfile())
  â†“
OnboardingCompletePage (å®Œæˆé¡µ)
  â†“
ChatPage (èŠå¤©ä¸»ç•Œé¢)
```

### 3. æœ¬åœ°å­˜å‚¨

ä½¿ç”¨ SharedPreferences å­˜å‚¨ï¼š
- **user_profile**: ç”¨æˆ·æ¡£æ¡ˆ JSON å­—ç¬¦ä¸²
- **onboarding_complete**: å¼•å¯¼æµç¨‹å®Œæˆæ ‡å¿— (bool)

```dart
// ä¿å­˜ç”¨æˆ·æ¡£æ¡ˆ
await UserStorageService.saveUserProfile(profile);

// æ£€æŸ¥å¼•å¯¼å®ŒæˆçŠ¶æ€
bool isComplete = await UserStorageService.isOnboardingComplete();

// è·å–ç”¨æˆ·æ¡£æ¡ˆ
UserProfile? profile = await UserStorageService.getUserProfile();
```

### 4. åº”ç”¨å¯åŠ¨é€»è¾‘

```dart
Future<Map<String, bool>> _checkAppStatus() async {
  // 1. æ£€æŸ¥ç”¨æˆ·å¼•å¯¼æµç¨‹
  final isOnboardingComplete = await UserStorageService.isOnboardingComplete();

  // 2. æ£€æŸ¥è®¾å¤‡æ¿€æ´»çŠ¶æ€
  final apiService = ApiService();
  final result = await apiService.waitForBindConfirmation();
  final isActivated = result['is_activated'] ?? false;

  return {
    'isOnboardingComplete': isOnboardingComplete,
    'isActivated': isActivated,
  };
}

// æ ¹æ®çŠ¶æ€å†³å®šæ˜¾ç¤ºå“ªä¸ªé¡µé¢
if (!isOnboardingComplete) {
  return WelcomePage();  // é¦–æ¬¡å¯åŠ¨
}
if (isActivated) {
  return ChatPage();      // å·²æ¿€æ´»
} else {
  return BindingPage();   // æœªæ¿€æ´»
}
```

---

## ğŸ¨ UI è®¾è®¡è¦ç‚¹

### 1. é…è‰²æ–¹æ¡ˆ
- ä¸»è‰²è°ƒ: `#667EEA` (ç´«è“è‰²æ¸å˜)
- è¾…åŠ©è‰²: `#764BA2` (æ·±ç´«è‰²)
- èƒŒæ™¯è‰²: ç™½è‰² / æ¸å˜ç´«
- é€‰ä¸­çŠ¶æ€: æµ…ç´«è‰²èƒŒæ™¯ + ç´«è‰²è¾¹æ¡†

### 2. äº¤äº’è®¾è®¡
- **å•é€‰é€‰é¡¹**: åœ†å½¢å‹¾é€‰æ¡† + é€‰ä¸­é«˜äº®
- **æäº¤æŒ‰é’®**: ä»…å½“æ‰€æœ‰é—®é¢˜å›ç­”åæ‰å¯ç‚¹å‡»
- **é¡µé¢è¿‡æ¸¡**: pushReplacement (æ— è¿”å›) / pushAndRemoveUntil (æ¸…é™¤å†å²)

### 3. å“åº”å¼å¸ƒå±€
- ä½¿ç”¨ `SafeArea` é€‚é…åˆ˜æµ·å±
- `SingleChildScrollView` æ”¯æŒå°å±å¹•æ»šåŠ¨
- æŒ‰é’®å›ºå®šåœ¨åº•éƒ¨ï¼Œå†…å®¹å¯æ»šåŠ¨

---

## ğŸ“Š æ•°æ®æµè½¬

```
ç”¨æˆ·å¡«å†™è¡¨å•
  â†“
UserInfoFormPage._handleSubmit()
  â”œâ”€ ç”Ÿæˆ UUID (userId)
  â”œâ”€ è·å–è®¾å¤‡ ID (deviceId)
  â”œâ”€ åˆ›å»º UserProfile å¯¹è±¡
  â””â”€ ä¿å­˜åˆ° SharedPreferences
  â†“
UserStorageService.saveUserProfile()
  â”œâ”€ åºåˆ—åŒ–ä¸º JSON
  â”œâ”€ ä¿å­˜ user_profile key
  â””â”€ è®¾ç½® onboarding_complete = true
  â†“
å¯¼èˆªåˆ° OnboardingCompletePage
  â†“
å¯¼èˆªåˆ° ChatPage (æ¸…é™¤æ‰€æœ‰å†å²è·¯ç”±)
```

---

## âœ… æµ‹è¯•æ£€æŸ¥é¡¹

- [x] ä»£ç ç¼–è¯‘æ— é”™è¯¯ (`flutter analyze`)
- [x] ä¾èµ–åŒ…å®‰è£…æˆåŠŸ (`flutter pub get`)
- [x] æ•°æ®æ¨¡å‹åºåˆ—åŒ–/ååºåˆ—åŒ–æ­£å¸¸
- [x] æœ¬åœ°å­˜å‚¨è¯»å†™åŠŸèƒ½æ­£å¸¸
- [x] é¡µé¢å¯¼èˆªæµç¨‹æ­£ç¡®
- [x] UI é€‚é…ä¸åŒå±å¹•å°ºå¯¸
- [ ] å®æœºæµ‹è¯•ç”¨æˆ·å¼•å¯¼æµç¨‹ (å¾…ç”¨æˆ·æµ‹è¯•)

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- **PRD æ–‡æ¡£**: `backend_claude_memory/specs/pocketspeak_PRD_v1.2.md`
- **å¼€å‘è·¯çº¿å›¾**: `backend_claude_memory/specs/development_roadmap.md`
- **å‘½åè§„èŒƒ**: `backend_claude_memory/specs/naming_convention.md`

---

## ğŸ“ åç»­å¾…åŠ

### V1.2 åç»­ä»»åŠ¡
1. **åç«¯ API å¼€å‘**:
   - `POST /api/user/init` - åˆ›å»ºç”¨æˆ·è®°å½•
   - `PUT /api/user/{user_id}` - æ›´æ–°ç”¨æˆ·æ•°æ®
   - `GET /api/user/{user_id}` - è·å–ç”¨æˆ·æ•°æ®

2. **æ•°æ®åŒæ­¥**:
   - å°†æœ¬åœ°ç”¨æˆ·æ¡£æ¡ˆåŒæ­¥åˆ°åç«¯
   - æ”¯æŒå¤šè®¾å¤‡æ•°æ®åŒæ­¥

### V1.3 é¢„ç•™åŠŸèƒ½
3. **è‹±è¯­æ°´å¹³æµ‹è¯•** (å¯é€‰):
   - å½“ç”¨æˆ·é€‰æ‹©"ä¸å¤ªç¡®å®š"æ—¶è§¦å‘
   - é€šè¿‡ GPT API è¯„ä¼°è‹±è¯­æ°´å¹³
   - æ›´æ–°ç”¨æˆ·æ¡£æ¡ˆä¸­çš„ english_level

---

## ğŸ‰ å®Œæˆæ€»ç»“

âœ… **å·²å®Œæˆå†…å®¹**:
1. ç”¨æˆ·æ•°æ®æ¨¡å‹ (UserProfile + æšä¸¾ç±»å‹)
2. ä¸‰ä¸ªå¼•å¯¼é¡µé¢ (Welcome + Form + Complete)
3. æœ¬åœ°å­˜å‚¨æœåŠ¡ (SharedPreferences)
4. ä¸»åº”ç”¨å…¥å£é›†æˆ (main.dart)
5. ä¾èµ–åŒ…é…ç½® (pubspec.yaml)
6. ä»£ç è´¨é‡æ£€æŸ¥ (æ— è­¦å‘Š/é”™è¯¯)

âœ… **æŠ€æœ¯äº®ç‚¹**:
- æ¸…æ™°çš„é¡µé¢æµç¨‹æ§åˆ¶
- å®Œæ•´çš„æ•°æ®æ¨¡å‹è®¾è®¡
- ä¼˜é›…çš„ UI/UX è®¾è®¡
- è§„èŒƒçš„ä»£ç ç»“æ„

âœ… **ç¬¦åˆè§„èŒƒ**:
- éµå¾ª PEP8 / Dart å‘½åè§„èŒƒ
- æŒ‰ç…§ PRD éœ€æ±‚å®ç°
- ä»£ç æ³¨é‡Šå®Œæ•´æ¸…æ™°

---

## ğŸ“ æ›´æ–°è®°å½•

### 2025-01-17 æ›´æ–° - å¢åŠ è‹±è¯­æ°´å¹³è¯¦ç»†è¯´æ˜

**ä¿®æ”¹å†…å®¹**:
- âœ… åœ¨ `EnglishLevel` æšä¸¾ä¸­å¢åŠ  `description` å­—æ®µ
- âœ… ä¸ºæ¯ä¸ªè‹±è¯­æ°´å¹³é€‰é¡¹æ·»åŠ è¯¦ç»†è¯´æ˜æ–‡å­—ï¼š
  - A1-å…¥é—¨ï¼ˆèƒ½è¿ç”¨æœ€åŸºç¡€çš„è¯­å¥ï¼‰
  - A2-åˆçº§ï¼ˆèƒ½ç®€å•äº¤æµè®¨è®ºé—®é¢˜ï¼‰
  - B1-ä¸­çº§ï¼ˆå¯ä»¥è½»æ¾åº”å¯¹æ—¥å¸¸è¯é¢˜ï¼‰
  - B2-ä¸­é«˜ï¼ˆå…¨è‹±æ–‡è¾“å‡ºå¤æ‚è§‚ç‚¹ï¼‰
  - C1-é«˜çº§ï¼ˆä¸å¤–å›½äººäº¤æµæ— éšœç¢ï¼‰
  - C2-ä¸“å®¶ï¼ˆå¦‚æ¯è¯­è€…èˆ¬ç†Ÿç»ƒï¼‰
  - ä¸å¤ªç¡®å®šï¼Ÿæµ‹ä¸€æµ‹æˆ‘çš„è‹±è¯­æ°´å¹³
- âœ… ä¿®æ”¹ `_buildOptionTile` æ–¹æ³•ï¼Œæ”¯æŒæ˜¾ç¤ºå‰¯æ ‡é¢˜æè¿°
- âœ… UI ä¼˜åŒ–ï¼šé€‰é¡¹å¡ç‰‡æ˜¾ç¤ºåŒè¡Œæ–‡å­—ï¼ˆæ ‡é¢˜ + æè¿°ï¼‰

**ä¿®æ”¹æ–‡ä»¶**:
- `lib/models/user_profile.dart` - å¢åŠ  description å­—æ®µ
- `lib/pages/onboarding/user_info_form_page.dart` - UI æ˜¾ç¤ºæè¿°æ–‡å­—

**æµ‹è¯•ç»“æœ**: âœ… flutter analyze é€šè¿‡ï¼Œæ— é”™è¯¯

---

**æ–‡æ¡£ç¼–å†™**: Claude Code
**å¼€å‘æ—¶é—´**: 2025-01-17
**ç‰ˆæœ¬**: V1.2
