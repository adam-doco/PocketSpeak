# PocketSpeak V1.1 Live2D å®ç° - ç¬¬ä¸€æ­¥å®ŒæˆæŠ¥å‘Š

**æ—¥æœŸ**: 2025-10-13
**ä»»åŠ¡**: Live2D æ¨¡å‹åŠ è½½æ˜¾ç¤º
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**è´Ÿè´£äºº**: Claude

---

## ğŸ“‹ ä»»åŠ¡æ¦‚è¿°

æ ¹æ®ç”¨æˆ·è¦æ±‚ï¼Œåˆ†æ­¥éª¤å®ç° Live2D æ¨¡å‹é›†æˆï¼š
- âœ… **ç¬¬ä¸€æ­¥**: æ¨¡å‹åŠ è½½æ˜¾ç¤ºï¼ˆæœ¬æ¬¡å®Œæˆï¼‰
- â³ **ç¬¬äºŒæ­¥**: è¡¨æƒ…åŠ¨ä½œåŒæ­¥ï¼ˆå¾…å®ç°ï¼‰
- â³ **ç¬¬ä¸‰æ­¥**: å£å‹è”åŠ¨ï¼ˆå¾…å®ç°ï¼‰

---

## ğŸ¯ æŠ€æœ¯æ–¹æ¡ˆç¡®å®š

### æ–¹æ¡ˆé€‰æ‹©

ç»è¿‡æ·±å…¥ç ”ç©¶ Zoev3 å’Œ Zoev4 çš„å®ç°ï¼Œä»¥åŠ Live2D å®˜æ–¹ SDK æƒ…å†µï¼Œæœ€ç»ˆç¡®å®šï¼š

**é€‰æ‹©æ–¹æ¡ˆ**: WebView + PIXI.js + pixi-live2d-display

**ç†ç”±**:
1. âœ… Live2D å®˜æ–¹ä¸æä¾› Flutter SDK
2. âœ… Web SDK (`pixi-live2d-display`) å®Œå…¨æ”¯æŒ Cubism 4
3. âœ… Zoev3/v4 å·²éªŒè¯è¯¥æ–¹æ¡ˆå¯è¡Œ
4. âœ… iOS/Android éƒ½åŸç”Ÿæ”¯æŒ WebView
5. âœ… æ”¯æŒå®Œæ•´çš„åŠ¨ä½œã€è¡¨æƒ…ã€å‚æ•°æ§åˆ¶ï¼ˆåŒ…æ‹¬å£å‹ï¼‰

**æŠ€æœ¯æ ˆ**:
- **å‰ç«¯**: Flutter + webview_flutter@4.13.0
- **WebViewå†…**: PIXI.js@7.3.2 + pixi-live2d-display@0.4.0
- **æ¨¡å‹æ ¼å¼**: Cubism 4 (.model3.json)

---

## ğŸ“‚ æ–‡ä»¶ç»“æ„

### å·²åˆ›å»ºçš„æ–‡ä»¶

```
frontend/pocketspeak_app/
â”œâ”€â”€ pubspec.yaml                                  # âœ… æ·»åŠ webview_flutterä¾èµ–å’Œassetsé…ç½®
â”œâ”€â”€ lib/
â”‚   â”œâ”€â”€ main.dart                                 # âœ… æ·»åŠ Live2Dæµ‹è¯•é¡µé¢è·¯ç”±
â”‚   â”œâ”€â”€ widgets/
â”‚   â”‚   â””â”€â”€ live2d_widget.dart                   # âœ… æ–°å»ºï¼šLive2Dç»„ä»¶
â”‚   â””â”€â”€ pages/
â”‚       â””â”€â”€ live2d_test_page.dart                # âœ… æ–°å»ºï¼šæµ‹è¯•é¡µé¢
â”œâ”€â”€ assets/
â”‚   â””â”€â”€ live2d/
â”‚       â”œâ”€â”€ index.html                            # âœ… æ–°å»ºï¼šLive2D WebViewé¡µé¢
â”‚       â””â”€â”€ models/
â”‚           â””â”€â”€ Mould/                            # âœ… å¤åˆ¶ï¼šå®Œæ•´æ¨¡å‹æ–‡ä»¶
â”‚               â”œâ”€â”€ Z.model3.json                 # æ¨¡å‹å®šä¹‰
â”‚               â”œâ”€â”€ Z.moc3                        # æ¨¡å‹æ•°æ®
â”‚               â”œâ”€â”€ Z.physics3.json               # ç‰©ç†å¼•æ“
â”‚               â”œâ”€â”€ motions/                      # 6ä¸ªåŠ¨ä½œæ–‡ä»¶
â”‚               â”œâ”€â”€ expressions/                  # 7ä¸ªè¡¨æƒ…æ–‡ä»¶
â”‚               â””â”€â”€ Z.4096/                       # 2ä¸ªè´´å›¾æ–‡ä»¶
```

---

## ğŸ”§ æ ¸å¿ƒå®ç°

### 1. HTML é¡µé¢ (`assets/live2d/index.html`)

**å…³é”®ç‰¹æ€§**:
- âœ… ä» CDN åŠ è½½ PIXI.js å’Œ Live2D SDK
- âœ… é€æ˜èƒŒæ™¯ï¼Œé€‚é… Flutter å±‚å å¸ƒå±€
- âœ… è‡ªé€‚åº”ç¼©æ”¾ï¼Œæ”¯æŒä¸åŒå±å¹•å°ºå¯¸
- âœ… JavaScript Channel åŒå‘é€šä¿¡
- âœ… è¯¦ç»†çš„æ—¥å¿—ç³»ç»Ÿ

**æ ¸å¿ƒAPI**:
```javascript
class Live2DController {
    async init()                          // åˆå§‹åŒ–
    async loadModel()                     // åŠ è½½æ¨¡å‹
    async playMotion(group, index)        // æ’­æ”¾åŠ¨ä½œ
    async playExpression(name)            // æ’­æ”¾è¡¨æƒ…
    positionModel()                       // è‡ªé€‚åº”å®šä½
    sendToFlutter(data)                   // å‘é€æ¶ˆæ¯åˆ°Flutter
}
```

**æ¨¡å‹è·¯å¾„**:
```javascript
// ä½¿ç”¨Flutter assetsç›¸å¯¹è·¯å¾„
this.model = await PIXI.live2d.Live2DModel.from('models/Mould/Z.model3.json');
```

### 2. Flutter Widget (`lib/widgets/live2d_widget.dart`)

**ä¸»è¦åŠŸèƒ½**:
- âœ… WebView å®¹å™¨
- âœ… JavaScript Channel æ¶ˆæ¯ç›‘å¬
- âœ… æä¾› Dart API æ§åˆ¶æ¨¡å‹

**æ ¸å¿ƒAPI**:
```dart
class Live2DWidget {
    Future<void> playMotion(String group, int index)  // æ’­æ”¾åŠ¨ä½œ
    Future<void> playExpression(String name)          // æ’­æ”¾è¡¨æƒ…
    Future<void> playIdle()                           // å¾…æœº
    Future<void> playHappy()                          // å¼€å¿ƒ
    Future<void> playSurprised()                      // æƒŠè®¶
    Future<void> playAngry()                          // ç”Ÿæ°”
}
```

**åŠ¨ä½œç´¢å¼•æ˜ å°„**:
```dart
0: Idle (å¾…æœº)
1: jingya (æƒŠè®¶)
2: kaixin (å¼€å¿ƒ)
3: shengqi (ç”Ÿæ°”)
4: wink (çœ¨çœ¼)
5: yaotou (æ‘‡å¤´)
```

**è¡¨æƒ…åç§°æ˜ å°„**:
```dart
"A1çˆ±å¿ƒçœ¼" - çˆ±å¿ƒ
"A2ç”Ÿæ°”" - æ„¤æ€’
"A3æ˜Ÿæ˜Ÿçœ¼" - æƒŠå¹
"A4å“­å“­" - å“­æ³£
"B1éº¦å…‹é£" - è¯´è¯ï¼ˆç‰¹æ®Šï¼‰
"B2å¤–å¥—" - è£…é¥°
"èˆŒå¤´" - è°ƒçš®
```

### 3. æµ‹è¯•é¡µé¢ (`lib/pages/live2d_test_page.dart`)

**åŠŸèƒ½**:
- âœ… å®Œæ•´çš„åŠ¨ä½œæµ‹è¯•æŒ‰é’®
- âœ… åŠ¨ä½œç´¢å¼• 0-5 æµ‹è¯•
- âœ… 7ç§è¡¨æƒ…æµ‹è¯•
- âœ… å®æ—¶çŠ¶æ€æ˜¾ç¤º

**è®¿é—®æ–¹å¼**:
```dart
Navigator.pushNamed(context, '/live2d_test');
```

---

## ğŸ§ª æµ‹è¯•æŒ‡å—

### è¿è¡Œæµ‹è¯•

1. **å¯åŠ¨åº”ç”¨**:
```bash
cd frontend/pocketspeak_app
flutter run
```

2. **è¿›å…¥æµ‹è¯•é¡µé¢**:
```dart
// æ–¹æ³•1: åœ¨ä»£ç ä¸­æ·»åŠ æµ‹è¯•æŒ‰é’®
FloatingActionButton(
  onPressed: () => Navigator.pushNamed(context, '/live2d_test'),
  child: Icon(Icons.face),
)

// æ–¹æ³•2: ä¸´æ—¶ä¿®æ”¹main.dartçš„homeä¸ºLive2DTestPage()
home: Live2DTestPage(),
```

3. **æµ‹è¯•é¡¹ç›®**:
   - âœ… æ¨¡å‹æ˜¯å¦æ­£å¸¸åŠ è½½æ˜¾ç¤º
   - âœ… ç‚¹å‡»"å¾…æœº"æŒ‰é’® â†’ æ’­æ”¾IdleåŠ¨ä½œ
   - âœ… ç‚¹å‡»"å¼€å¿ƒ"æŒ‰é’® â†’ æ’­æ”¾å¼€å¿ƒåŠ¨ä½œ+çˆ±å¿ƒçœ¼è¡¨æƒ…
   - âœ… ç‚¹å‡»"åŠ¨ä½œ0-5" â†’ æµ‹è¯•æ‰€æœ‰åŠ¨ä½œç´¢å¼•
   - âœ… ç‚¹å‡»è¡¨æƒ…æŒ‰é’® â†’ æµ‹è¯•æ‰€æœ‰è¡¨æƒ…

### é¢„æœŸç»“æœ

#### âœ… æˆåŠŸæ ‡å¿—
- æ¨¡å‹åœ¨å±å¹•ä¸­å¤®æ˜¾ç¤º
- ç‚¹å‡»æŒ‰é’®åæ¨¡å‹åšå‡ºç›¸åº”åŠ¨ä½œ
- æ§åˆ¶å°è¾“å‡ºè¯¦ç»†æ—¥å¿—ï¼ˆ`[Live2D INFO]` ç­‰ï¼‰

#### âŒ å¯èƒ½çš„é—®é¢˜

**é—®é¢˜1**: æ¨¡å‹ä¸æ˜¾ç¤º
```
åŸå› : assetsè·¯å¾„é…ç½®é”™è¯¯
è§£å†³: æ£€æŸ¥pubspec.yamlä¸­çš„assetsé…ç½®
```

**é—®é¢˜2**: WebViewç©ºç™½
```
åŸå› : JavaScriptæœªå¯ç”¨æˆ–åŠ è½½å¤±è´¥
è§£å†³: æ£€æŸ¥index.htmlæ˜¯å¦æ­£ç¡®åŠ è½½ï¼ŒæŸ¥çœ‹æ§åˆ¶å°æ—¥å¿—
```

**é—®é¢˜3**: æ¨¡å‹æ˜¾ç¤ºä½†æ— æ³•æ§åˆ¶
```
åŸå› : JavaScriptChannelé€šä¿¡å¤±è´¥
è§£å†³: æ£€æŸ¥FlutterChannelæ˜¯å¦æ­£ç¡®æ³¨å†Œ
```

---

## ğŸ“Š Zoev3/v4 å¯¹æ¯”åˆ†æ

### Zoev3 å®ç°
- **ç¯å¢ƒ**: PyQt + QWebEngineView
- **åŠ è½½æ–¹å¼**: æœ¬åœ°HTML + CDNèµ„æº
- **é€šä¿¡**: PyQtä¸JSäº’è°ƒ
- **å£å‹**: ç®€åŒ–æ–¹æ³•ï¼ˆ`ParamMouthOpenY`, `ParamMouthForm`ï¼‰

### Zoev4 å®ç°
- **ç¯å¢ƒ**: çº¯Webï¼ˆæµè§ˆå™¨ï¼‰
- **åŠ è½½æ–¹å¼**: å®Œå…¨Webéƒ¨ç½²
- **é€šä¿¡**: WebSocketå®æ—¶é€šä¿¡
- **å£å‹**: å‚æ•°æ‰«ææ³•ï¼ˆæœç´¢æ‰€æœ‰mouthç›¸å…³å‚æ•°ï¼‰

### PocketSpeak å®ç°
- **ç¯å¢ƒ**: Flutter + WebView
- **åŠ è½½æ–¹å¼**: Flutter assets + CDNèµ„æº
- **é€šä¿¡**: JavaScriptChannelåŒå‘é€šä¿¡
- **å£å‹**: **å¾…å®ç°**ï¼ˆç¬¬ä¸‰æ­¥ï¼‰

---

## ğŸš€ åç»­æ­¥éª¤

### ç¬¬äºŒæ­¥ï¼šè¡¨æƒ…åŠ¨ä½œåŒæ­¥ï¼ˆä¸‹ä¸€æ­¥ï¼‰

**ç›®æ ‡**: æ ¹æ®å°æ™ºAIçš„emotionå“åº”æ’­æ”¾å¯¹åº”çš„Live2DåŠ¨ä½œå’Œè¡¨æƒ…

**ä»»åŠ¡**:
1. åˆ›å»ºæƒ…æ„Ÿæ˜ å°„è¡¨ï¼ˆå‚è€ƒZoev4çš„emotion_mapping.pyï¼‰
2. ç›‘å¬WebSocketæ¶ˆæ¯ä¸­çš„emotionå­—æ®µ
3. è°ƒç”¨Live2DWidgetçš„playMotion/playExpression

**é¢„è®¡å·¥ä½œé‡**: 2-3å°æ—¶

### ç¬¬ä¸‰æ­¥ï¼šå£å‹è”åŠ¨

**ç›®æ ‡**: TTSæ’­æ”¾æ—¶Live2Dæ¨¡å‹å˜´éƒ¨è·ŸéšéŸ³é¢‘åŠ¨ä½œ

**ä»»åŠ¡**:
1. åœ¨HTMLä¸­å®ç°å˜´éƒ¨å‚æ•°æ§åˆ¶
2. ç›‘å¬TTSæ’­æ”¾çŠ¶æ€ï¼ˆstart/stopï¼‰
3. å¯åŠ¨/åœæ­¢å˜´éƒ¨åŠ¨ç”»å¾ªç¯

**é¢„è®¡å·¥ä½œé‡**: 3-4å°æ—¶

---

## ğŸ‰ å®Œæˆæƒ…å†µæ€»ç»“

### âœ… å·²å®Œæˆ
- [x] æŠ€æœ¯æ–¹æ¡ˆè°ƒç ”ä¸ç¡®å®š
- [x] WebView Live2Dæ¶æ„è®¾è®¡
- [x] HTMLé¡µé¢å¼€å‘ï¼ˆå®Œæ•´çš„Live2Dæ§åˆ¶å™¨ï¼‰
- [x] Flutter Widgetå°è£…
- [x] æµ‹è¯•é¡µé¢å¼€å‘
- [x] ä¾èµ–å®‰è£…ä¸é…ç½®
- [x] æ–‡æ¡£ç¼–å†™

### ğŸ“ æ–‡ä»¶æ¸…å•
| æ–‡ä»¶ | è¡Œæ•° | çŠ¶æ€ |
|------|------|------|
| index.html | 334 | âœ… æ–°å»º |
| live2d_widget.dart | 166 | âœ… æ–°å»º |
| live2d_test_page.dart | 165 | âœ… æ–°å»º |
| pubspec.yaml | 110 | âœ… ä¿®æ”¹ |
| main.dart | 90 | âœ… ä¿®æ”¹ |

### ğŸ† æŠ€æœ¯äº®ç‚¹
1. âœ… **æ— éœ€native SDK** - çº¯Webæ–¹æ¡ˆï¼Œè·¨å¹³å°å…¼å®¹æ€§å¼º
2. âœ… **å®Œæ•´åŠŸèƒ½ä¿ç•™** - æ”¯æŒCubism 4çš„æ‰€æœ‰ç‰¹æ€§
3. âœ… **æ¸…æ™°çš„æ¶æ„** - HTML/Dartåˆ†ç¦»ï¼ŒèŒè´£æ˜ç¡®
4. âœ… **è¯¦ç»†çš„æ—¥å¿—** - ä¾¿äºè°ƒè¯•å’Œé—®é¢˜å®šä½
5. âœ… **å¯æ‰©å±•è®¾è®¡** - é¢„ç•™å£å‹åŒæ­¥æ¥å£

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [pixi-live2d-display GitHub](https://github.com/guansss/pixi-live2d-display)
- [Live2D Cubism SDK å®˜æ–¹æ–‡æ¡£](https://docs.live2d.com/)
- [webview_flutter æ’ä»¶æ–‡æ¡£](https://pub.dev/packages/webview_flutter)
- Zoev3 æºç : `backend/services/voice_chat/emotion_mapping.py`
- Zoev4 æºç : `index.html:2950-3080` (å˜´å‹æ§åˆ¶)

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **ç½‘ç»œä¾èµ–**: é¦–æ¬¡åŠ è½½éœ€è¦CDNä¸‹è½½PIXI.jså’ŒLive2D SDKï¼ˆçº¦2MBï¼‰
2. **æ€§èƒ½è€ƒè™‘**: WebViewæ¸²æŸ“æ€§èƒ½å–å†³äºè®¾å¤‡ï¼Œä½ç«¯è®¾å¤‡å¯èƒ½éœ€è¦é™ä½åˆ†è¾¨ç‡
3. **è·¯å¾„é—®é¢˜**: assetsè·¯å¾„å¿…é¡»ä¸pubspec.yamlé…ç½®ä¸€è‡´
4. **è°ƒè¯•æŠ€å·§**: ä½¿ç”¨Chrome DevToolsè°ƒè¯•WebViewå†…éƒ¨JavaScript

---

**ä¸‹ä¸€æ­¥è¡ŒåŠ¨**: ç­‰å¾…ç”¨æˆ·æµ‹è¯•åé¦ˆï¼Œç¡®è®¤æ¨¡å‹åŠ è½½æ­£å¸¸åï¼Œå¼€å§‹å®æ–½ç¬¬äºŒæ­¥ï¼ˆè¡¨æƒ…åŠ¨ä½œåŒæ­¥ï¼‰ã€‚

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**æœ€åæ›´æ–°**: 2025-10-13 23:30
